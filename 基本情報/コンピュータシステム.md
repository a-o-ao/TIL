# コンピュータシステム

- [命令実行サイクル](#命令実行サイクル)
- [キャッシュメモリ](#キャッシュメモリ)

## 命令実行サイクル

### 命令実行サイクルの4つのステップ

```
┌─────────┐
│ 命令フェッチ  │ ← PC参照 → メモリ → IR格納
└─────┬───┘
      ↓
┌─────────┐
│ デコード    │ ← IR解析、アドレス指定方式決定
└─────┬───┘
      ↓
┌─────────┐
│ オペランド読出 │ ← レジスタ / メモリ / 即値
└─────┬───┘
      ↓
┌─────────┐
│ 命令実行    │ → ALU / 制御回路
└─────────┘
```

### 主なアドレス指定方式

| アドレス指定方式 | 特徴 |
| --- | --- |
| 即値 | 値が命令内に直接含まれる |
| レジスタ | 汎用レジスタ内のデータを使う |
| 直接 | 命令内にメモリアドレスが含まれる |
| 間接 | 指定先に格納されたアドレスを参照する |
| インデックス | 基本アドレスにオフセットを加えて実効アドレスを求める |
| 基底レジスタ | 基底レジスタの値にオフセットを加えて実効アドレスを求める |
| 相対 | プログラムカウンタにオフセットを加えて実効アドレスを求める |


## キャッシュメモリ
### キャッシュメモリと主記憶がある場合の平均アクセス時間

```
AMAT = h × Tc + (1 − h) × Tm
```

- h：キャッシュヒット率
- 𝑇𝑐：キャッシュヒット時のアクセス時間
- Tm：キャッシュミス時にかかるアクセス時間（＝主記憶アクセス時間）

### ライトスルー方式とライトバック方式

| 方式 | 動作 | 利点 | 欠点 | 主な用途 |
| --- | --- | --- | --- | --- |
| ライトスルー (Write Through) | キャッシュに書き込むと同時に主記憶にも書き込む | 主記憶が常に最新で整合性管理が簡単 | 主記憶アクセスが多く遅くなる | 小規模キャッシュや整合性重視のシステム |
| ライトバック (Write Back) | キャッシュにだけ書き込み、追い出し時に主記憶へ反映（ダーティビットで管理） | 主記憶アクセスが減り高速 | 主記憶とキャッシュの内容が一時的に不一致になる、制御が複雑 | 高速化重視のCPUキャッシュ |


### 記憶装置

| 種類 | 読み書き | 特徴 | 主な用途 |
| --- | --- | --- | --- |
| DRAM (Dynamic RAM) | 読み書き可能 | 安価・大容量・アクセスはやや遅い・定期的にリフレッシュ必要 | 主記憶（メインメモリ） |
| SRAM (Static RAM) | 読み書き可能 | 高速・高価・容量小・リフレッシュ不要 | CPUキャッシュメモリ |
| ROM (Read Only Memory) | 読み出し専用（書き換え困難または不可） | 電源OFFでも内容保持・製造時に書き込み | ファームウェア、BIOS |
| SSD (Solid State Drive) | 読み書き可能 | 高速・フラッシュメモリ利用・機械駆動部なし | ストレージ装置（OS、データ保存） |

#### ROM
- マスクROM (書き込み不可)
- EEPROM (電気で書き換え、一括またはブロック単位で消去可能)


