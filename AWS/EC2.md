# Amazon EC2

## AMI

AMI（Amazon Machine Image） は、EC2（Elastic Compute Cloud）のインスタンスを起動するためのテンプレートです。
AMIには、OS、アプリケーション、設定など、EC2インスタンスを立ち上げるために必要なすべての情報が含まれています。

### AMIを複数アカウントで共有した場合のソリューション

1. Launch Permissionの設定<br>
AMIを特定のAWSアカウントと共有するために、Launch Permissionを設定できます。この方法では、AMIに対して、他のアカウントがそのAMIを使ってインスタンスを起動できるように許可します。

2. Amazon EC2 Resource Access Manager（RAM）の利用<br>
AWS Resource Access Manager (RAM) を使用することで、AWS Organizations内の複数のアカウントに対してAMIを共有することができます。これにより、複数のアカウント間でリソースを安全に共有できます。

3. S3を使用したAMIバックアップと共有<br>
AMIをバックアップとしてS3バケットに保存し、必要に応じて他のアカウントとS3バケットを共有する方法もあります。この方法では、AMIイメージをS3経由で共有し、異なるアカウントで使用できます。

## インスタンスタイプ

| カテゴリ                 | インスタンスタイプ           | 特徴 |
|------------------------|---------------------|--------------------------------------------------|
| **汎用（バースト可能）**  | t3, t4g             | コスト効率が良く、CPUクレジットベースで動作する小規模アプリ向け。 |
| **汎用（スタンダード）**  | m5, m6g, m7g       | バランスの取れた性能で、幅広い用途に対応。 |
| **コンピューティング最適化** | c5, c6g, c7g       | 高いCPU性能が求められる計算集約型ワークロード向け。 |
| **メモリ最適化**         | r5, r6g, r7g       | メモリ集約型アプリケーション（インメモリDB、キャッシュ）向け。 |
| **ストレージ最適化**     | i3, i4g, d3, d3en  | 高速なローカルストレージが必要なデータ集約型ワークロード向け。 |
| **アクセラレーテッドコンピューティング** | p4, p5, inf2, trn1 | GPUや専用チップを搭載し、機械学習やHPC向け。 |
| **高メモリ**           | u6i, u7i           | 超大容量メモリを必要とするSAP HANAなどの用途向け。 |
| **z1dシリーズ**       | z1d                | 高クロックのCPUを提供し、金融計算やゲームサーバー向け。 |

## キャパシティ予約

| 項目                       | 説明                                                                                                     |
| -------------------------- | -------------------------------------------------------------------------------------------------------- |
| キャパシティ予約           | ✓ インスタンスタイプが起動可能であるという確保権のこと。<br>✓ 予約キャパシティを確保しておくことで実行時のキャパシティ不足エラーを抑制する。 |
| オンデマンドキャパシティ予約 | ✓ 必要な期間中のみオンデマンドの利用料金でキャパシティが予約できる機能                                             |
| ゾーンリザーブドインスタンス | ✓ 指定したアベイラビリティーゾーン (AZ) 内で1年間または3年間の間のキャパシティを予約する。<br>✓ AZは指定した場所のみ利用可能。 |
| リージョンリザーブドインスタンス | ✓ 指定したリージョン内で1年間または3年間の間のキャパシティを予約する。<br>✓ AZはどこでも利用可能。                 |


## EC2のログ取得方法

| 方法                          | 説明                                                                                             | デフォルト | 設定が必要 |
|-------------------------------|----------------------------------------------------------------------------------------------------|----------|------------|
| CloudWatch Logs                | EC2のシステムログやアプリケーションログをCloudWatchに送信して管理・モニタリングできる。             | ×        | 〇          |
| システムログ（/var/log）        | インスタンス内のLinuxディレクトリに保存されるログ。SSH接続で直接確認可能。                         | 〇        | ×          |
| S3へログ出力                   | ログを圧縮してS3バケットにアップロードし、長期保存する方法。                                        | ×        | 〇          |
| CloudTrail                     | EC2 APIコール（起動、停止、変更など）を記録し、アカウント操作履歴を追跡。                          | ×        | 〇          |
| VPC Flow Logs                  | VPC内のネットワークトラフィックをキャプチャしてモニタリングに利用。                                  | ×        | 〇          |
| OSレベルのログ管理ツール        | FluentdやFilebeatを使って外部サービスにログを転送。                                                  | ×        | 〇          |

