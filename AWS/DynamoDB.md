# Amazon DynamoDB

## オンデマンドモードとプロビジョニングモード

| モード | 説明 |
| --- | --- |
| オンデマンドモード | 必要に応じてリソースを自動的に追加。<br>トラフィック量の予測が困難な場合にリクエストの実績数に応じて課金。<br>Read/Write処理を自動的にスケールアップ/ダウン。 |
| プロビジョニングモード | 事前にリソースを割り当てて予算を管理 |

### キャパシティユニット

DynamoDBのキャパシティユニットとは、データを読み書きするためのパフォーマンス指標です。
以下の2種類があります。

- 読み取りキャパシティユニット（RCU: Read Capacity Unit）
  - 1秒間に強力な整合性読み取りを1回、または最終的整合性読み取りを2回実行できる能力。
  - サイズ：4KBまでのデータ。
- 書き込みキャパシティユニット（WCU: Write Capacity Unit）
  - 1秒間に1回の書き込み操作を実行できる能力。
  - サイズ：1KBまでのデータ。

## DynamoDB トランザクション機能

DynamoDB トランザクション機能は、DynamoDBテーブルに対する1 つのオペレーションとして複数の項目の追加、更新、または削除が必要となる複雑なビジネスワークフローを管理できます。
DynamoDBのトランザクション機能を使うことで、複数のアイテムを安全に一括処理でき、データの整合性を保つことができます。金融取引や在庫管理など、データの一貫性が重要なユースケースに適しています。

- Put — `PutItem` オペレーションを開始し、条件付きで、または条件をまったく指定せずに、新しい項目を作成するか、古い項目を新しい項目に置き換えます。
- Update — `UpdateItem` オペレーションを開始し、既存の項目の属性を編集するか、まだ存在しない場合は新しい項目をテーブルに追加します。条件付きまたは条件なしで既存の項目で属性を追加、削除、更新するには、このアクションを使用します。
- Delete — `DeleteItem` オペレーションを開始し、プライマリキーにより識別される 1 つの項目をテーブルで削除します。
- `ConditionCheck` — 項目が存在することを確認するか、項目の特定の属性の条件を確認します。

## DynamoDB ストリーム

DynamoDBストリーム（DynamoDB Streams） は、DynamoDBテーブルのデータ変更（追加・更新・削除）をリアルタイムでキャプチャし、他のAWSサービスやアプリケーションで利用できるようにする機能です。

### 主な特徴
1. データ変更の記録
DynamoDBテーブルに対する`書き込み操作（PutItem, UpdateItem, DeleteItem）`をキャプチャ。
変更内容は「ストリームレコード」として保持される。
2. 変更データの取得方法
AWS Lambda、Amazon Kinesis などと連携して処理可能。
ポーリング方式でストリームデータを取得。
3. ストリームの保持期間
最大24時間データが保持される。
4. 4つのストリームモード（取得できるデータ）
KEYS_ONLY: 変更されたアイテムのプライマリキーのみ。
NEW_IMAGE: 変更後のデータのみ。
OLD_IMAGE: 変更前のデータのみ。
NEW_AND_OLD_IMAGES: 変更前後の両方のデータ。

### ユースケース

- リアルタイムデータ処理
データの変更を検知し、AWS Lambda で`自動処理（通知、分析、集計など）`を実行。
- 監査・ログ管理
変更履歴を S3 や CloudWatch に保存し、監
査ログとして活用。
- データレプリケーション
別の DynamoDB テーブルや他のデータベースへリアルタイムで同期。
- キャッシュの自動更新
`ElastiCache（Redis）`などのキャッシュと連携し、データ変更時にキャッシュを更新。
### まとめ
DynamoDBストリームを使うことで、DynamoDBのデータ変更をリアルタイムに監視・処理でき、さまざまな用途（イベント駆動型アーキテクチャ、監査、データ同期など）に活用できます。