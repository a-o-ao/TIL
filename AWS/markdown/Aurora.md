# Amazon Aurora

https://docs.aws.amazon.com/ja_jp/AmazonRDS/latest/AuroraUserGuide/CHAP_AuroraOverview.html

- (1) データベースインスタンスとストレージが分離したアーキテクチャ
- (2) マルチAZによる高い耐障害性
- (3) 自動フェイルオーバーによる高可用性
- (4) データベースのクローンを高速作成

## エンドポイント(接続先)

### クラスターエンドポイント
- 更新・参照・DBの定義変更など、DBへのすべてのアクセスをおこなう
- 接続先：プライマリインスタンス

### 読み取りエンドポイント
- 参照のみおこなう
- 接続先：レプリカインスタンス

### インスタンスエンドポイント
- インスタンスへの直接アクセスをおこなう
  - プライマリインスタンスへ接続した場合：更新やDBの操作など
  - レプリカインスタンスへ接続した場合：参照
- 接続先：各インスタンス

##  Aurora Global Database

1つのプライマリリージョンに書き込みDBを持ち、他のリージョンに読み取り専用のレプリカを配置できる Aurora の機能です。

### 主な特徴

- プライマリリージョンで障害が発生した場合の目標復旧時点（RPO）は1秒、目標復旧時間（RTO）は1分未満と定めている

| 項目 | 内容 |
|------|------|
| 複数リージョン対応 | プライマリ＋最大5つのリードレプリカリージョンに対応 |
| レプリカの用途 | グローバルアプリ向けの読み取り最適化（地域ごとにレイテンシ削減） |
| レプリケーション | 1秒未満のレイテンシで非同期レプリケーション（専用の高速ネットワーク） |
| フェイルオーバー | プライマリが障害時、他リージョンを昇格して継続運用可能 |
| 対応エンジン | Aurora MySQL と Aurora PostgreSQL に対応（バージョン制限あり） |


### 注意点
- 複数リージョンでも書き込みは1リージョンのみ
- セカンダリリージョンは読み取り専用（必要に応じて昇格可）
- グローバルデータベースの構成には専用の設定が必要（通常のレプリカとは異なる）

### Aurora Global Database（PostgreSQL vs. MySQL）の違い

| **機能**              | **Aurora PostgreSQL**          | **Aurora MySQL**               |
|----------------------|-----------------------------|-------------------------------|
| **マルチマスター**    | ✅ **対応**                  | ❌ **非対応**                  |
| **書き込み可能リージョン** | **複数のリージョンで書き込み可能** | **プライマリリージョンのみ書き込み可能** |
| **フェイルオーバー**  | **任意のリージョンをプライマリ化可能** | **セカンダリリージョンを昇格（ただし1つのマスターのみ）** |
| **レプリケーション方式** | **同期レプリケーション**    | **非同期レプリケーション**      |
| **整合性モデル**      | **強整合性**                  | **最終的整合性**               |
| **ユースケース**      | **グローバルに分散した書き込みが必要な場合** | **グローバルに分散した読み取りが必要な場合** |

## Aurora Serverlessの機能

DBインスタンスの負荷状況に応じて、自動的にDBインスタンスの起動、停止、スケールアップ/スケールダウンを実施する機能

- 通常のAuroraではDBインスタンス作成時にインスタンスタイプ（db.t3.mediumなど）を指定
- Aurora Serverlessではデータベースの負荷状況に応じた性能で稼働
- データベースの需要がないときはDBインスタンスを停止し、需要があれば自動的に起動
- データベースの利用率に変動のあるシステムや、利用量の予測が難しいシステムに使用すると、コスト削減の効果が期待できる
