# Amazon Elastic Container Service (ECS)

https://docs.aws.amazon.com/ja_jp/AmazonECS/latest/developerguide/Welcome.html

コンテナ化されたアプリケーションを簡単にデプロイ、管理、スケーリングできる、完全マネージド型のコンテナオーケストレーションサービス。

## 主要機能

- クラスター
  - 1つ以上のタスクまたはサービスで構成される論理グループ
  - クラスターでは、コンテナが動作するVPCやサブネットなどを設定

- タスク
  - ECSで管理するコンテナの実行単位
  - タスク内のコンテナは、実行するコンテナイメージ、CPUやメモリのスペック、タスクロールなどを定義した「タスク定義」に基づいて起動される
  - ※タスクロールとはコンテナが他のAWSサービスを利用する際に設定するアクセス権限（IAMロール）のこと

- サービス
  - クラスター内で必要なタスク数を維持する機能
  - あるタスクが異常終了して必要なタスク数を下回った場合、サービスが新しいタスクを起動して自動復旧する
  - サービスでは、起動するタスクのタスク定義、必要なタスク数、ELBとの連携などを設定

## ECSのスケーリング

| スケーリング対象	| 説明 |
| ---- | ---- |
| サービススケーリング |	ECSサービスのタスク数を自動調整する（＝コンテナ数） |
| クラスタースケーリング |	ECSクラスター内のEC2インスタンスの数を自動調整する（EC2起動数） |
※EC2 起動タイプ使用時のみ

### サービススケーリングの方法

| 方法 |	説明 |
| ---- | ---- |
| 手動スケーリング |	管理コンソールやCLIから手動でタスク数を調整 |
| ターゲット追跡スケーリング |	指定したメトリクス（例：CPU使用率）を維持するようにタスク数を自動調整 |
| ステップスケーリング |	メトリクスのしきい値に応じて段階的にスケール（例：70%超えたら+2タスク） |
| スケジュールスケーリング |	曜日や時間でタスク数を自動で増減（例：毎朝9時に5タスクに） |

### クラスター（EC2）スケーリングの方法

| 方法 |	説明 |
| ---- | ---- |
| 手動スケーリング |	Auto Scaling グループのサイズを手動調整 |
| Auto Scaling | ポリシー連携	クラスターレベルでEC2の数を自動スケーリング（Application Auto ScalingやStep Scaling） |
| Capacity Provider |	タスクの需要に応じてEC2を自動増減（新しい推奨方式） |

## サービススケジューラ

https://docs.aws.amazon.com/ja_jp/AmazonECS/latest/developerguide/scheduling_tasks.html

長期実行するステートレスサービスやアプリケーションに適している。<br>
短時間ごと実行するような場合は EventBridge Scheduler のほうが向いている。
