# Amazon ElastiCache

## ElastiCache Memcached と ElastiCache Redis の違い

RedisはMemcachedよりも高機能なデータベースエンジンで、耐障害性の機能として「自動フェイルオーバー」「マルチAZ」を備えています。

| 項目                     | **ElastiCache Memcached**                         | **ElastiCache Redis**                         |
|-------------------------|--------------------------------|--------------------------------|
| **データ構造**         | シンプルなキー・バリュー型キャッシュ | 多様なデータ構造（リスト、セット、ハッシュなど） |
| **永続性**             | なし（インメモリのみ） | オプションでスナップショット保存が可能 |
| **マルチスレッド対応** | 対応（並列処理が可能） | 非対応（シングルスレッド） |
| **レプリケーション**   | なし（シングルノードのみ） | あり（プライマリ-レプリカ構成が可能） |
| **高可用性（フェイルオーバー）** | なし | あり（自動フェイルオーバー対応） |
| **トランザクション**   | 非対応 | 対応（MULTI/EXECによる処理） |
| **パーティショニング** | クライアント側でシャーディング | ネイティブなクラスタリング対応 |
| **用途**              | シンプルなキャッシュ、分散キャッシュ | キャッシュ、キュー、ランキング、セッション管理 |
| **適したユースケース** | 高速なキー・バリュー型キャッシュが必要な場合 | 高可用性やデータ構造を活用する場合 |

### Memcached vs Redis のスケール方法の違い

| 項目               | **Memcached**                          | **Redis**                               |
|-------------------|--------------------------------|--------------------------------|
| **スケール方法**   | 水平スケールのみ（ノード追加/削除） | 水平スケール（クラスタリング） + 垂直スケール（ノードのサイズ変更） |
| **シャーディング** | クライアント側で手動設定が必要 | Redis Cluster が自動で管理 |
| **レプリケーション** | なし（単一ノードのみ） | あり（プライマリ-レプリカ構成） |
| **フェイルオーバー** | なし | あり（プライマリ障害時にレプリカ昇格） |
| **データの再配置** | 手動（ノード追加時にリシャーディングが必要） | 自動（クラスタでデータ分散を管理） |
| **スケールの柔軟性** | 低い（手動設定が多い） | 高い（自動管理が可能） |

### どちらを選ぶべきか？

| **要件**                              | **推奨する方式**        |
|--------------------------------------|----------------------|
| シンプルなキャッシュ用途だけ使いたい  | **Memcached**        |
| 高可用性が必要（フェイルオーバー対応） | **Redis**            |
| データの整合性を保ちたい（レプリケーション） | **Redis**            |
| ノードのスケールを簡単に管理したい    | **Redis**            |
| 超高速のキー・バリュー型キャッシュが必要 | **Memcached**        |
| 複雑なデータ構造（リスト・セットなど）を扱いたい | **Redis**            |
| クライアント側でシャーディングを管理できる | **Memcached**        |
| 自動スケールやクラスタリングを利用したい | **Redis**            |

## キャッシュ戦略

### ライト（書き込み）スルー戦略

データベースへのデータ書き込みや更新が行われるたびに、同時にキャッシュにも書き込む
- キャッシュのデータが常に最新の状態を保たれるため、データの整合性が維持される
- 書き込み性能が若干低下する可能性がある
- アクセスされないデータがキャッシュに蓄積される

### 遅延読み込み戦略

データベースへの書き込みを優先し、必要な時にのみキャッシュにデータを書き込む
- 要求されたデータのみがキャッシュされるため、リソースの無駄遣いを減らすことができる
- キャッシュとデータベース間で一時的なデータの不一致が生じる
- キャッシュミス（キャッシュからデータを取得できなかった）した場合には、データ取得に時間がかかることがある
