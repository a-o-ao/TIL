# AWS Key Management Service（KMS）

## エンベロープ暗号化

AWS KMSでは「KMSキー」「データキー」と呼ばれる2種類の鍵を使用してデータの暗号化および復号を行う。二段階で鍵を保護する方式を「エンベロープ暗号化（Envelope Encryption）」という。

- **「データキー」**: データを暗号化する際に使用
- **「KMSキー」**: データキーを暗号化する際に使用
- データキーは通常、暗号化を行う対象のサービスごとに作成する

## KMSキーの種類

- **AWSマネージド型**: AWSによって作成・管理されるもの。ユーザーは削除できない
- **カスタマーマネージド型**: ユーザーが作成・削除、および管理を行う。KMSでは鍵の自動ローテーション（定期的な更新）をサポート

## キーポリシー

キーポリシーは、KMSキーへ適用するリソースベースのポリシーです。鍵に対して、IAMユーザーまたはIAMロール、他のAWSアカウントからの操作可能な権限を設定します。

### 鍵の使用と鍵の共有
鍵の作成者とは異なるIAMユーザーやIAMロールが、鍵を使って暗号化や復号をしたい場合、キーユーザーとして使用者を追加できます。

また、別のAWSアカウントで鍵を使用したい場合は、対象のアカウントと鍵を共有します（クロスアカウント）。

暗号化されたAMIやデータベースのスナップショットなどを他のアカウントと共有する際に利用します。

## AWS CloudTrailと連携

鍵の使用ログ（いつどのサービスで鍵が使用されたか）が記録されるため、鍵の利用状況を監査することができる

## AWS Secrets Managerとの連携

KMSと連携すると、シークレットを保護するためにデータキーが使用されます。ローテーションが行われるたびデータキーも新しいものが自動的に生成されるため、高いセキュリティの認証を実現できます。

---

## AWS CloudHSM

専用のハードウェアデバイスを用いて暗号化鍵を生成・管理するシングルテナントサービスで、高レベルのセキュリティを提供する。貸し出されるハードウェアは世界的な暗号化ハードウェアの規格（FIPS 140-2 のレベル 3）で認証済みのため、信頼性の高さが強みです。

なお、「CloudHSM」のHSM（Hardware Security Module）とは、データセキュリティを高めるための暗号鍵を保護しつつ運用するデバイスのことです。

- KMSと比べると利用料金が高価
- 法令や規制等の要件で、認定を受けたハードウェアで暗号化鍵を管理する必要があるようなケースでは、CloudHSMを使用