# AWS DataSync

AWS DataSync は、オンプレミスとAWS間、またはAWSの異なるストレージ間でデータを高速・安全に転送するマネージドサービスです。
データは暗号化されて転送される。

https://docs.aws.amazon.com/ja_jp/datasync/latest/userguide/what-is-datasync.html

### 主な機能
- 高速なデータ転送
  - 通常のコピーより 最大10倍速い（データの圧縮、並列処理、自動チューニングを活用）。

- シンプルな操作
  - エージェントをインストールして転送設定するだけで利用可能（CLIやSDK不要）。

- 増分同期対応
  - 初回のフルコピー後、変更されたデータのみを同期するため効率的。

- セキュリティ
  - 暗号化通信（TLS）、IAMによるアクセス制御、転送データの整合性検証をサポート。

- スケジュール実行可能
  - 定期的なデータ同期を自動化できる。

### 対応ストレージ

| **転送元**                     | **転送先**                      |
|--------------------------------|--------------------------------|
| オンプレミス NFS ストレージ     | Amazon S3                     |
| オンプレミス SMB ストレージ     | Amazon EFS                    |
| オンプレミス ファイルシステム   | Amazon FSx（Windows, Lustre, NetApp ONTAP） |
| Amazon S3                      | Amazon S3（別リージョン間コピー） |
| Amazon S3                      | Amazon EFS                    |
| Amazon S3                      | Amazon FSx（Windows, Lustre, NetApp ONTAP） |
| Amazon EFS                     | Amazon S3                     |
| Amazon EFS                     | Amazon EFS（別リージョン間コピー） |
| Amazon FSx                     | Amazon FSx（別リージョン間コピー） |


### EFSへの移行
Amazon EFSは、特定のアベイラビリティゾーンに依存せず、VPC内で利用できるファイルシステムです。このため、Amazon EFSにアクセスするEC2インスタンスは、同じVPC内に配置することが推奨されます。Amazon EFSファイルシステムを作成し、使用するための手順は以下の通りです。

1. Amazon EFSファイルシステムを作成します。

2. Amazon EC2リソースを作成し、インスタンスを起動してファイルシステムをマウントします。

3. AWS DataSyncを利用して、EFSファイルシステムにファイルを転送します。

4. リソースをクリーンアップし、AWSアカウントのセキュリティを確保します。


## AWS DataSync と AWS Storage Gateway の違い

| 項目 | **AWS DataSync** | **AWS Storage Gateway** |
|------|------------------|--------------------------|
| 主な目的 | データの**高速かつ一方向の転送**（バッチ転送） | オンプレとクラウドの**継続的な連携／キャッシュ** |
| 想定ユースケース | - 移行<br>- バックアップ<br>- 定期的なファイル転送 | - ハイブリッド環境のストレージ拡張<br>- クラウドにバックアップ保存<br>- ローカルでの高速アクセス |
| 通信の方向 | 主に **オンプレ → AWS**（片方向） | **双方向通信あり**（ローカルとAWS間） |
| AWSリソース間のデータ転送 | ✅ 可能 | ❌ 基本的に不可 |
| データ転送のタイミング | 手動 or スケジュール実行（バッチ） | 継続的／リアルタイム同期（キャッシュ） |
| サポートプロトコル | NFS, SMB, Amazon S3 | NFS, SMB（File Gateway）<br>iSCSI（Volume Gateway）<br>VTL（Tape Gateway） |
| ローカルキャッシュ | ❌ なし | ✅ あり（ローカルにキャッシュ領域を持つ） |
| ハードウェア提供 | ❌ ソフトウェアエージェントのみ | ✅ 仮想アプライアンス or ハードウェアアプライアンス |
| 用途の例 | - オンプレからS3への一括データ移行<br>- データレイク構築 | - オンプレからS3への透過的なアクセス<br>- バックアップ先としてVTLをクラウド化 |

Storage Gatewayは、AWSへデータを移行した後もオンプレミスから継続してデータが更新されるケースで利用する。
