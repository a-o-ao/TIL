# CloudFront

### 署名付きCookiesと署名付きURLの違い

| 特徴                   | 署名付きURL                         | 署名付きCookies                    |
|------------------------|------------------------------------|-------------------------------------|
| **制御対象**           | 個別のファイル（オブジェクト）       | 複数のファイルやサイト全体         |
| **使用シーン**         | 特定のファイルへのアクセス制限     | サイト全体または複数のファイルへのアクセス制限 |
| **制御方法**           | 各URLに署名を付ける →URLが変わってしまう   | クッキーを使用してアクセス制御     |
| **利点**               | 単一のリソースに対する制御が簡単   | 複数のリソースに一度にアクセス可能 |
| **URLの発行方法**     | 各リソースごとに署名付きURLを発行   | 1回の署名で複数リソースを制御      |

#### 使い分け
- 署名付きURL: 一度に1つのリソース（ファイル）へのアクセス制限が必要な場合、例えば、特定の動画や画像を1回だけアクセス可能にしたい時。
- 署名付きCookies: ユーザーが複数のリソース（例えば、複数の動画）をまとめて利用できるように制御したい場合。

### CloudFrontディストリビューションのキャッシュヒット率向上のための設定

1. **キャッシュポリシーの最適化**  
   キャッシュTTLを適切に設定し、コンテンツのキャッシュを管理。

2. **オリジンサーバーの設定**  
   `Cache-Control`ヘッダでキャッシュの有効期限を指定し、バージョン管理でキャッシュを効率的に更新。

3. **クエリパラメータの管理**  
   不要なクエリパラメータを無視して、キャッシュミスを減らす。

4. **ヘッダとクッキーの最適化**  
   不要なヘッダやクッキーを除外し、キャッシュ効率を向上。

5. **コンテンツ圧縮**  
   圧縮コンテンツ（GzipやBrotli）を使用してキャッシュ効率を高める。

6. **インバリデーションの最小化**  
   コンテンツにバージョン番号を追加して、インバリデーションを減らす。

7. **エッジロケーションの活用**  
   最寄りのエッジロケーションからコンテンツを提供して、パフォーマンス向上。

## S3オリジンへのアクセス制御

各S3バケットに対してCloudFrontのみが読み取りを行えるようにするバケットポリシーを設定する場合、OAIまたはOACを使用した設定が必須です。CloudFrontディストリビューションエンドポイントの設定は行えません。

### OAI (Origin Access Identity)
- **目的**: S3 バケットなどのオリジンサーバーへのアクセスを制限し、CloudFront からのリクエストだけを許可する。

- **使い方**: OAI を設定することで、S3 バケットに対して CloudFront 経由のアクセスのみを許可し、直接のアクセス（外部ユーザーによるアクセス）を防止できる。

- **設定方法**: CloudFront ディストリビューションに OAI を関連付け、その OAI を使って S3 バケットポリシーを設定。

### OAC (Origin Access Control)
- **目的**: OAI の進化版で、CloudFront からのアクセスをより詳細に制御できる新しいアクセス制御メカニズム。

- **特徴**: OAC を使用すると、S3 バケットやカスタムオリジンに対してアクセス制御を強化し、より柔軟なセキュリティ設定が可能。

- **設定方法**: OAC は、CloudFront とオリジンとの通信をより詳細に管理するための新しいアプローチを提供し、アクセス権限を細かく制御できる。

#### まとめ
- **OAI**: 主に S3 バケットへのアクセス制限 に使用され、CloudFront 経由のアクセスのみを許可。
- **OAC**: OAI の進化版で、より柔軟で強力な オリジンへのアクセス制御 を提供。
