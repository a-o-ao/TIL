# Amazon S3

## AWS Storage Gateway
オンプレミスとAWS間でデータを連携するハイブリッドクラウドストレージサービス。

### iSCSI デバイス
iSCSI（Internet Small Computer System Interface）デバイス とは、IPネットワーク上でSCSIプロトコルを使用してストレージを接続するデバイス です。

- 特徴:
  - ネットワーク経由でブロックストレージを提供（ローカルディスクのように利用可能）
  - SAN（Storage Area Network）を構築するために使用
  - FC（Fibre Channel）より低コストで構築可能
- ユースケース:
  - サーバーがリモートストレージをローカルディスクのように使用
  - データベースや仮想化環境（VMware、Hyper-Vなど）のストレージとして活用
  - バックアップやディザスタリカバリ（DR）環境の構築

AWS では iSCSI ベースのストレージとして AWS Storage Gateway（ボリュームゲートウェイ）を提供。

### ボリュームゲートウェイ
オンプレミスのサーバーにiSCSI経由で接続し、バックアップやキャッシュをAWS上のストレージに保存するAWS Storage Gatewayの一機能。

| 種類         | データの主な保存場所 | 特徴                                 | ユースケース        |
|--------------|--------------------|--------------------------------------|---------------------|
| **キャッシュ型** | **AWS（S3）**        | よく使うデータのみローカルにキャッシュ | ストレージをクラウド化 |
| **保存型**     | **オンプレミス**       | データをローカルに保持しつつ、スナップショットをAWSへ | DR対策・バックアップ |

## S3のパフォーマンス向上

### プレフィックス
プレフィックスを利用して日付ベースでアップロードを分散することで少なくとも 3,500 リクエスト/秒、データの取得で 5,500 リクエスト /秒をサポートできるようにパフォーマンスを自動的に向上させることができます。

## オブジェクトロック

保存されているデータが削除されない方法には2種類ある。

- Amazon S3バケットにMFA Delete機能を適用して、ユーザーによるデータ削除時にMFA入力を必須化して、誤った削除を防止する。
- Amazon S3バケットの初期設定でデータが削除されないS3バケットをロックする。

オブジェクトロックは 保持モード（Retention Mode） と リーガルホールド（Legal Hold）　の2つのモードがあり、
保持モードはさらに コンプライアンスモード と ガバナンスモード がある。

| モード                   | 特徴                                                                                 | ユースケース                                |
|------------------------|----------------------------------------------------------------------------------------|---------------------------------------------|
| **ガバナンスモード**     | 管理者が許可すれば削除可能。IAM権限で制御。                                             | 誤削除防止、管理者の制御権限を残す場合        |
| **コンプライアンスモード** | 誰も削除不可。保持期間が過ぎるまで絶対保護。                                       | 法的要件や監査対応が必要なデータ              |
| **リーガルホールド**     | 保持期間に依存せず、無期限で削除を防止。管理者が手動で解除可能。                        | 訴訟中や法的義務によりデータ保護が必要な場合  |

